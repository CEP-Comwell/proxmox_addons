# Main NFTables Configuration for Proxmox VE with SDN
# Generated by Ansible - DO NOT EDIT MANUALLY

# Flush all rules and delete all tables
flush ruleset

# Include individual bridge rules
include "/etc/nftables.d/vmbr99_rules.nft"
include "/etc/nftables.d/vmbr1_rules.nft"
include "/etc/nftables.d/vmbr2_rules.nft"

# Include tenant-specific rules (dynamically generated)
{% for tenant in tenants | default([]) %}
include "/etc/nftables.d/tenant_{{ tenant.tenant_id | default(tenant.id) }}_vmbr99_rules.nft"
include "/etc/nftables.d/tenant_{{ tenant.tenant_id | default(tenant.id) }}_vmbr1_rules.nft"
include "/etc/nftables.d/tenant_{{ tenant.tenant_id | default(tenant.id) }}_vmbr2_rules.nft"
{% endfor %}

# Basic IPv4/IPv6 tables (if needed)
# table inet filter {
#     chain input {
#         type filter hook input priority 0;
#         policy drop;
#
#         # Allow loopback
#         iif "lo" accept;
#
#         # Allow established connections
#         ct state established,related accept;
#
#         # Allow ICMP
#         icmp type { echo-request, echo-reply } accept;
#         icmpv6 type { echo-request, echo-reply } accept;
#
#         # Allow SSH
#         tcp dport 22 accept;
#
#         # Allow Proxmox services
#         tcp dport { 8006, 5900, 3128 } accept;
#     }
#
#     chain forward {
#         type filter hook forward priority 0;
#         policy drop;
#
#         # Allow forwarding between bridges
#         iif { "vmbr99", "vmbr1", "vmbr2" } oif { "vmbr99", "vmbr1", "vmbr2" } accept;
#
#         # Allow established connections
#         ct state established,related accept;
#     }
#
#     chain output {
#         type filter hook output priority 0;
#         policy accept;
#     }
# }