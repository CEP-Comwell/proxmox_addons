# NFTables Rules for vmbr1 (Tenant Bridge)
# Generated by Ansible - DO NOT EDIT MANUALLY

# Bridge filtering for vmbr1
table bridge vmbr1_filter {
    chain input {
        type filter hook input priority -200;

        {% for rule in nftables_bridge_rules.ingress %}
        {{ rule }}
        {% endfor %}
    }

    chain forward {
        type filter hook forward priority -200;

        {% for rule in nftables_bridge_rules.egress %}
        {{ rule }}
        {% endfor %}

        # Default drop
        drop;
    }
}

# IP filtering for vmbr1 traffic
table ip vmbr1_ip {
    chain input {
        type filter hook input priority -200;

        # Tenant network traffic rules
        iif "vmbr1" tcp dport { 80, 443 } accept;
        iif "vmbr1" udp dport 53 accept;
        iif "vmbr1" icmp type { echo-request, echo-reply } accept;
    }

    chain forward {
        type filter hook forward priority -200;

        # Allow tenant traffic forwarding to management only
        iif "vmbr1" oif "vmbr99" accept;  # To management
        iif "vmbr99" oif "vmbr1" accept;  # Return traffic
    }
}