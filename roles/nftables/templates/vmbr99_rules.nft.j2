# NFTables Rules for vmbr99 (Management Bridge)
# Generated by Ansible - DO NOT EDIT MANUALLY
# Supports both ingress (input) and egress (forward) filtering

# Bridge filtering for vmbr99
table bridge vmbr99_filter {
    # INGRESS: Traffic entering the bridge
    chain input {
        type filter hook input priority -200;

        {% for rule in nftables_bridge_rules.ingress %}
        {{ rule }}
        {% endfor %}
    }

    # EGRESS/FORWARD: Traffic leaving the bridge to other interfaces
    chain forward {
        type filter hook forward priority -200;

        {% for rule in nftables_bridge_rules.egress %}
        {{ rule }}
        {% endfor %}

        # Default drop (egress)
        drop;
    }
}

# IP filtering for vmbr99 traffic (Layer 3)
table ip vmbr99_ip {
    # INGRESS: IP traffic entering the system
    chain input {
        type filter hook input priority -200;

        # Management traffic rules (ingress)
        iif "vmbr99" tcp dport { 22, 80, 443, 8006 } accept;
        iif "vmbr99" udp dport { 53, 123 } accept;
        iif "vmbr99" icmp type { echo-request, echo-reply } accept;
    }

    # EGRESS: IP traffic being forwarded
    chain forward {
        type filter hook forward priority -200;

        # Allow forwarding to tenant bridges
        iif "vmbr99" oif { "vmbr1", "vmbr2" } accept;
        iif { "vmbr1", "vmbr2" } oif "vmbr99" accept;
    }
}