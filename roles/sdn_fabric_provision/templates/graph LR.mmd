graph LR

%% Bridges
ProxmoxBridge["vmbr0 (Linux bridge) ports: ens2f0 (Proxmox default)"]
MgmtBridge["vmbr99 (OVSBridge) ports: eth2, mtu: 9000, vlan_aware: true"]
VMBridge["vmbr1 (OVSBridge) ports: eth1, mtu: 9000, vlan_aware: true"]
ExtBridge["vmbr2 (Linux bridge) ports: xg1, mtu: 1420, VyOS uplink"]

%% vmbr2 subinterfaces
Gateway1["gateway1 (vlan 100)"]
Gateway2["gateway2 (vlan 200)"]
LegacyVLAN["legacy-vlan100 (vlan 100)"]
VX10031Ifc["vxlan10031 (vxlan id 10031)"]
VX9003Ifc["vxlan9003 (vxlan id 9003)"]
VX9006Ifc["vxlan9006 (vxlan id 9006)"]

%% VXLANs and Gateway
VX10100["vxlan10100 tenant1_mgmt"]
VX10101["vxlan10101 tenant1_engineering"]
VX10102["vxlan10102 tenant1_support"]
VX10031["vxlan10031 ceph_cluster"]
VX10032["vxlan10032 core_services"]
VX10110["vxlan10110 tenant1_services"]
VX9000["vxlan9000 shared_services"]
VX9006["vxlan9006 edgesec_vault"]
VX9003["vxlan9003 proxy_ext"]
VX10120["vxlan10120 tenant1_ext"]
edgesecGW{{"edgesec-gw-rr-yyz-01 edgesec-SDN Global Fabric Gateway"}}

%% Bridge to VNI relationships
MgmtBridge --> VX10100
MgmtBridge --> VX10101
MgmtBridge --> VX10102
MgmtBridge --> VX10031
MgmtBridge --> VX10032

VMBridge --> VX10110
VMBridge --> VX9000
VMBridge --> VX9006

ExtBridge --> VX10120
ExtBridge --> VX9003Ifc
ExtBridge --> VX9006Ifc
ExtBridge --> VX10031Ifc
ExtBridge --> Gateway1
ExtBridge --> Gateway2
ExtBridge --> LegacyVLAN

%% vmbr2 subinterfaces feeding Gateway / SDN fabric
Gateway1 --> edgesecGW
Gateway2 --> edgesecGW
LegacyVLAN --> edgesecGW
VX10031Ifc --> edgesecGW
VX9003Ifc --> edgesecGW
VX9006Ifc --> edgesecGW

%% SDN fabric VNIs terminate on Gateway
VX10100 --> edgesecGW
VX10101 --> edgesecGW
VX10102 --> edgesecGW
VX10110 --> edgesecGW
VX9000 --> edgesecGW
VX9006 --> edgesecGW
VX9003 --> edgesecGW
VX10120 --> edgesecGW
VX10031 --> edgesecGW
VX10032 --> edgesecGW

%% Color coding
classDef mgmt fill:#e3f2fd,stroke:#1976d2,stroke-width:2px;
classDef vm fill:#fffde7,stroke:#fbc02d,stroke-width:2px;
classDef ext fill:#fbe9e7,stroke:#d84315,stroke-width:2px;
class ProxmoxBridge mgmt;
class MgmtBridge,VX10100,VX10101,VX10102,VX10031,VX10032 mgmt;
class VMBridge,VX10110,VX9000,VX9006 vm;
class ExtBridge,Gateway1,Gateway2,LegacyVLAN,VX10031Ifc,VX9003Ifc,VX9006Ifc,VX9003,VX10120,edgesecGW ext;