

{% for bridge in linux_bridges %}
auto {{ bridge.name }}
iface {{ bridge.name }} inet manual
    {% if bridge.bridge_ports is defined and bridge.bridge_ports|length > 0 %}bridge-ports {{ bridge.bridge_ports | join(' ') }}
    {% elif bridge.parent is defined and bridge.parent|length > 0 %}bridge-ports {{ bridge.parent }}
    {% endif %}
    bridge-stp off
    bridge-fd 0
    {% if bridge.vlans is defined and bridge.vlans|length > 0 %}
    bridge-vlan-aware yes
    bridge-pvid {{ bridge.vlans[0].id }}
    bridge-vids {{ bridge.vlans | map(attribute='id') | join(' ') }}
    {% endif %}
    {% if bridge.mtu is defined %}mtu {{ bridge.mtu }}
    {% endif %}
    {% if bridge.post_up is defined %}post-up {{ bridge.post_up }}
    {% endif %}

{% if bridge.subinterfaces is defined and bridge.subinterfaces|length > 0 %}
{% for sub in bridge.subinterfaces %}
auto {{ sub.name }}
iface {{ sub.name }} inet static
    {% if sub.vlan_id is defined %}vlan-id {{ sub.vlan_id }}
    vlan-raw-device {{ bridge.name }}
    {% endif %}
    {% if sub.address is defined %}address {{ sub.address }}
    {% endif %}
    bridge {{ bridge.name }}

{% endfor %}
{% endif %}

{% endfor %}
